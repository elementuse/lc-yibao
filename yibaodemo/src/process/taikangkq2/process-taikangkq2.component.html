<div [ngSwitch]="state" id="aabbcc">
    <div *ngSwitchCase="'Initial'">
        <div class="m-portlet m-portlet--mobile">
            <div class="m-portlet__head">
                <div class="m-portlet__head-caption">
                    <div class="m-portlet__head-title">
                        <h3 class="m-portlet__head-text">
                            泰康齿科商保
                        </h3>
                    </div>
                </div>
            </div>
            <div class="m-portlet__body">
                <div class="m-portlet m-portlet--tabs m-portlet--primary m-portlet--head-solid-bg m-portlet--head-sm">
                    <div class="m-portlet__head">
                        <div class="m-portlet__head-caption">
                            <div class="m-portlet__head-title">
                                <h3 class="m-portlet__head-text">
                                    <span>个人信息</span>
                                </h3>
                            </div>
                        </div>
                    </div>
                    <div class="m-portlet__body">

                        <div class="row align-items-end">
                            <div class="col-md-3">
                                <label for="Keyword">证件类型</label>
                                <select id="IdType" class="form-control" name="IdType" [(ngModel)]="patient.idType"
                                    tabindex="-98">
                                    <option value="身份证">身份证</option>
                                    <option value="护照">护照</option>
                                    <option value="军官证">军官证</option>
                                    <option value="驾照">驾照</option>
                                    <option value="户口本">户口本</option>
                                    <option value="学生证">学生证</option>
                                    <option value="工作证">工作证</option>
                                    <option value="其他">其他</option>
                                    <option value="无证件">无证件</option>
                                    <option value="社保号">社保号</option>
                                    <option value="出生证">出生证</option>
                                    <option value="士兵证">士兵证</option>
                                    <option value="港澳通行证">港澳通行证</option>
                                    <option value="台湾通行证">台湾通行证</option>
                                    <option value="港澳台同胞证">港澳台同胞证</option>
                                    <option value="出生医学证明">出生医学证明</option>
                                    <option value="外国人永久居留身份证">外国人永久居留身份证</option>
                                </select>
                            </div>

                            <div class="col-md-3">
                                <label for="Keyword">证件号</label>
                                <input id="IdCard" [(ngModel)]="patient.idCard" name="IdCard" class="form-control"
                                    placeholder="请输入证件号..." type="text">
                            </div>

                            <div class="col-md-3">
                                <label for="Keyword">用户姓名</label>
                                <input id="pName" [(ngModel)]="patient.pName" name="pName" class="form-control"
                                    placeholder="请输入用户姓名..." type="text">
                            </div>
                            <div class="col-md-3">
                                    <button type="submit" class="btn btn-primary blue" [disabled]="patient==null || patient?.idType==null||patient?.idCard==''||patient?.name==''||patient?.partnerId==''"
                                    (click)="queryInsurance()">查询</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="m-portlet m-portlet--tabs m-portlet--primary m-portlet--head-solid-bg m-portlet--head-sm"
                    [hidden]="showInsuranceList==false">
                    <div class="m-portlet__head">
                        <div class="m-portlet__head-caption">
                            <div class="m-portlet__head-title">
                                <h3 class="m-portlet__head-text">
                                    <span>保险列表</span>
                                </h3>
                            </div>
                        </div>
                    </div>
                    <div class="m-portlet__body">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>&nbsp;</th>
                                    <th>保险号</th>
                                    <th>险种</th>
                                    <th>生效日期</th>
                                    <th>失效日期</th>
                                    <th>已报销次数</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of insuranceData?.data.policyInfos">
                                    <td><input type="checkbox" disabled="disabled" [checked]="item.policyNo==currentPolicyNo" /></td>
                                    <td>{{item.policyNo}}</td>
                                    <td>{{item.insuranceName}}</td>
                                    <td>{{item.effectiveDate}}</td>
                                    <td>{{item.expirationDate}}</td>
                                    <td>{{item.claimNum}}</td>
                                    <td>
                                        <button type="submit" class="btn btn-primary blue" [disabled]="patient==null"
                                            (click)="preSettle(item)">试算</button>
                                        <button type="submit" class="btn btn-primary blue" [disabled]="patient==null"
                                            (click)="queryInsuranceDetail(item)">详情</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div [hidden]="showPreSettleList==false">
                    <div class="m-portlet m-portlet--tabs m-portlet--primary m-portlet--head-solid-bg m-portlet--head-sm">
                        <div class="m-portlet__head">
                            <div class="m-portlet__head-caption">
                                <div class="m-portlet__head-title">
                                    <h3 class="m-portlet__head-text">
                                        <span>试算结果</span>
                                    </h3>
                                </div>
                            </div>
                        </div>
                        <div class="m-portlet__body">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>项目编号</th>
                                        <th>项目名称</th>
                                        <th>单位</th>
                                        <th>单价</th>
                                        <th>数量</th>
                                        <th>金额</th>
                                        <th>理赔金额</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let item of payList">
                                        <td>{{item.itemNo}}</td>
                                        <td>{{item.itemName}}</td>
                                        <td>{{item.unit}}</td>
                                        <td>{{item.price}}</td>
                                        <td>{{item.amount}}</td>
                                        <td>{{item.total}}</td>
                                        <td>{{item.payMoney}}</td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="row">
                                <div class="col-md-12">
                                    <span>总金额：{{hisData?.total}}</span>
                                    <span style="margin-left:30px">报销金额：{{preSettleOutput?.receipt?.reimbursement}}</span>
                                    <span style="margin-left:30px">折扣优惠：{{preSettleOutput?.receipt?.discount}}</span>
                                    <span style="margin-left:30px">自费金额：{{preSettleOutput?.receipt?.remaining}}</span>
                                </div>
                            </div>

                            <div class="row">
                                <span>&nbsp;</span>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary blue" [hidden]="showPreSettleList==false" [disabled]="currentPolicyNo==''"
                        (click)="settle()">提交</button>
                    <button type="submit" class="btn btn-danger" (click)="fail('放弃泰康齿科保险结算')">放弃</button>
                </div>
            </div>
        </div>

        <p-dialog header="保单号:{{tempPolicyInfo?.policyNo}}" [(visible)]="display" [modal]="true" blockScroll="true">
            <div *ngFor="let insuranceInfos of infos">
                <div class="row" style="margin-top:10px;font-size: 18px">
                    <div class="col-md-5">{{insuranceInfos.insuranceName}}</div>
                    <div class="col-md-7">有效期 {{tempPolicyInfo?.effectiveDate}}至{{tempPolicyInfo?.expirationDate}}</div>
                </div>
                <div *ngFor="let dutyInfo of insuranceInfos.dutyInfoList">
                    <div *ngIf="dutyInfo.dutyType === 'times'">
                        <div class="row" style="margin-top:10px">
                            <div class="col-md-8" style="padding-left:50px">{{dutyInfo.dutyName}}</div>
                        </div>
                        <div class="row" *ngFor="let item of dutyInfo.items">
                            <div class="col-md-8" style="padding-left:70px;color: #9c9c9c">{{item.itemName}}</div>
                            <div class="col-md-3">{{item.itemNum}}次</div>
                        </div>
                    </div>
                    <div *ngIf="dutyInfo.dutyType === 'quota'">
                        <div class="row" style="margin-top:10px">
                            <div class="col-md-8" style="padding-left:50px">{{dutyInfo.dutyName}}</div>
                            <div class="col-md-3">{{dutyInfo.dutyAmount}}元</div>
                        </div>
                        <div class="row" style="margin-top:5px;padding-left: 60px;">
                            <span style="margin-left:10px; border: 1px solid #9c9c9c; border-radius: 10%;color: #9c9c9c"
                                *ngFor="let item of dutyInfo.items">{{item.itemName}}</span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- <p-footer>
                <button type="button" pButton icon="pi pi-check" (click)="display=false" label="Yes"></button>
                <button type="button" pButton icon="pi pi-close" (click)="display=false" label="No" class="ui-button-secondary"></button>
            </p-footer> -->
        </p-dialog>

    </div>
    <div *ngSwitchCase="'Commited'">
        <div class="m-portlet m-portlet--mobile">
            <div class="m-portlet__head">
                <div class="m-portlet__head-caption">
                    <div class="m-portlet__head-title">
                        <h3 class="m-portlet__head-text">
                            单号: {{currentPolicyNo}} 已提交 , 请上传发票信息
                        </h3>
                    </div>
                </div>
            </div>
            <div class="m-portlet__body">
                <div class="m-portlet m-portlet--tabs m-portlet--primary m-portlet--head-solid-bg m-portlet--head-sm">
                    <div class="m-portlet__head">
                        <div class="m-portlet__head-caption">
                            <div class="m-portlet__head-title">
                                <h3 class="m-portlet__head-text">
                                    <span>补充发票信息</span>
                                </h3>
                            </div>
                        </div>
                    </div>
                    <div class="m-portlet__body">
                        <div class="row">
                            <div class="col-md-12">
                                <span>请输入发票号：</span>
                            </div>
                            <div class="col-md-12">
                                <input id="receiptNo" [(ngModel)]="receiptNo" name="receiptNo" class="form-control"
                                    placeholder="" type="text">
                            </div>
                        </div>

                        <div class="row" [hidden]="receiptNo==''">
                            <div class="col-md-12">
                                <form role="form">
                                    <div class="form-group m-form__group">
                                        <label for="DefaultFileUploadFileInput" class="control-label">选择附件</label>
                                        <p-fileUpload multiple="multiple" id="DefaultFileUploadFileInput" name="DefaultFileUploadFileInput[]"
                                            [url]="uploadUrl" accept="image/*" maxFileSize="1000000" (onUpload)="onUpload($event)"
                                            (onBeforeSend)="onBeforeSend($event)" chooseLabel="选择" uploadLabel="开始上传"
                                            cancelLabel="全部删除">

                                            <ng-template pTemplate="content">
                                                <ul *ngIf="uploadedFiles.length">
                                                    <li *ngFor="let file of uploadedFiles">{{file.name}} -
                                                        {{file.size}} bytes</li>
                                                </ul>
                                            </ng-template>
                                        </p-fileUpload>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="m-portlet m-portlet--tabs m-portlet--primary m-portlet--head-solid-bg m-portlet--head-sm">
                    <div class="m-portlet__head">
                        <div class="m-portlet__head-caption">
                            <div class="m-portlet__head-title">
                                <h3 class="m-portlet__head-text">
                                    <span>出单结果</span>
                                </h3>
                            </div>
                        </div>
                    </div>
                    <div class="m-portlet__body">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>项目编号</th>
                                    <th>项目名称</th>
                                    <th>单位</th>
                                    <th>单价</th>
                                    <th>数量</th>
                                    <th>金额</th>
                                    <th>理赔金额</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of payList">
                                    <td>{{item.itemNo}}</td>
                                    <td>{{item.itemName}}</td>
                                    <td>{{item.unit}}</td>
                                    <td>{{item.price}}</td>
                                    <td>{{item.amount}}</td>
                                    <td>{{item.total}}</td>
                                    <td>{{item.payMoney}}</td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="row">
                            <div class="col-md-12">
                                <span>总金额：{{hisData?.total}}</span>
                                <span style="margin-left:30px">报销金额：{{preSettleOutput?.receipt?.reimbursement}}</span>
                                <span style="margin-left:30px">折扣优惠：{{preSettleOutput?.receipt?.discount}}</span>
                                <span style="margin-left:30px">自费金额：{{preSettleOutput?.receipt?.remaining}}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div *ngSwitchCase="'Settled'">
        <div class="m-portlet m-portlet--mobile">
            <div class="m-portlet__head">
                <div class="m-portlet__head-caption">
                    <div class="m-portlet__head-title">
                        <h3 class="m-portlet__head-text">
                            单号: {{currentPolicyNo}} 出单完成
                        </h3>
                    </div>
                </div>
            </div>
            <div class="m-portlet__body">


                <div class="m-portlet m-portlet--tabs m-portlet--primary m-portlet--head-solid-bg m-portlet--head-sm">
                    <div class="m-portlet__head">
                        <div class="m-portlet__head-caption">
                            <div class="m-portlet__head-title">
                                <h3 class="m-portlet__head-text">
                                    <span>出单结果</span>
                                </h3>
                            </div>
                        </div>
                    </div>
                    <div class="m-portlet__body">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>项目编号</th>
                                    <th>项目名称</th>
                                    <th>单位</th>
                                    <th>单价</th>
                                    <th>数量</th>
                                    <th>金额</th>
                                    <th>理赔金额</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of payList">
                                    <td>{{item.itemNo}}</td>
                                    <td>{{item.itemName}}</td>
                                    <td>{{item.unit}}</td>
                                    <td>{{item.price}}</td>
                                    <td>{{item.amount}}</td>
                                    <td>{{item.total}}</td>
                                    <td>{{item.payMoney}}</td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="row">
                            <div class="col-md-12">
                                <span>总金额：{{hisData?.total}}</span>
                                <span style="margin-left:30px">报销金额：{{preSettleOutput?.receipt?.reimbursement}}</span>
                                <span style="margin-left:30px">折扣优惠：{{preSettleOutput?.receipt?.discount}}</span>
                                <span style="margin-left:30px">自费金额：{{preSettleOutput?.receipt?.remaining}}</span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div *ngSwitchCase="'SettleFailed'">
        <div class="m-portlet m-portlet--mobile">
            <div class="m-portlet__head">
                <div class="m-portlet__head-caption">
                    <div class="m-portlet__head-title">
                        <h3 class="m-portlet__head-text">
                            泰康齿科保险 结算失败
                        </h3>
                    </div>
                </div>
            </div>
            <div class="m-portlet__body">
                {{failedMessage}}
            </div>
        </div>
    </div>
</div>